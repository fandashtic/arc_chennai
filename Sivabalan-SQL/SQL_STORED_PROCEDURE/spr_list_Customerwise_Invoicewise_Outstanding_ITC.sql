CREATE PROCEDURE [dbo].[spr_list_Customerwise_Invoicewise_Outstanding_ITC]  (@ToDate datetime,   @Weekdays nVarchar(50),   @SalesPerson nVarchar(50)   )   AS   DECLARE @INV AS NVARCHAR(50)   SELECT @INV = Prefix FROM VoucherPrefix WHERE TranID = N'INVOICE'   Select DocumentID,DocumentDate,status into #collections1   from Collections where Status is NULL or Status=1   select distinct collectiondetail.OriginalID,   "totalcollection"=SUM(collectiondetail.AdjustedAmount) into #tempba   from collectiondetail,#collections1   where Collectiondetail.Documenttype IN (4,5) and   Collectiondetail.collectedAmount is not NULL and   #collections1.DocumentDate <= @ToDate and   #collections1.DocumentID = CollectionDetail.CollectionID   --and #collections1.status NOT IN (128,194,192)   Group By  collectiondetail.OriginalID   Select DocumentID,   "INVOI" = @INV + CAST(DocumentID AS nVARCHAR),   CustomerID, DocReference, InvoiceDate,   "DayID"= Datepart (dw,InvoiceDate),   "BillValue"=NetValue + RoundOffAmount, BeatID,SalesmanID,Status,   "DueDate" = DateDiff (dy,InvoiceDate,@ToDate)   into #Cus from InvoiceAbstract   WHERE  InvoiceType in (1,3) AND InvoiceDate <= @TODATE   And (InvoiceAbstract.Status & 128) = 0   and InvoiceAbstract.paymentmode!=1   Order by DocumentID   Select #Cus.Invoi,#Cus.BillValue,IsNull(#tempba.totalcollection,0.00)   as totalcollection  into #cus2   From #Cus LEFT OUTER JOIN #tempba   On  #Cus.Invoi =#tempba.OriginalID   Select Invoi, BillValue, totalcollection,   "Balance" = (BillValue-totalcollection) into #Cus3   From #cus2   SELECT  DocumentID,   "CustomerID" = #Cus.CustomerID,   "Customer Name" = Customer.Company_Name,   "InvoiceID" = #Cus.Invoi,   "Doc Ref" = #Cus.DocReference,   "Document Date" = #Cus.InvoiceDate,   --#Cus.DayID,   "Bill Value" = #Cus.BillValue,   --"Collected Amount"= #Cus3.totalcollection,   "Balance" = #Cus3.Balance,   "Beat" = Beat.Description,   "Salesman" = Salesman.Salesman_Name,   "Due Date" = #cus.DueDate   FROM #Cus,Customer,  #cus3 ,Beat, Salesman   WHERE  #Cus.CustomerID = Customer.CustomerID AND   #Cus.DayID IN (Select WeekID from Weekdays where Days like @Weekdays) AND   #Cus.Invoi = #Cus3.Invoi AND   #Cus.BeatID *= Beat.BeatID And   #Cus.SalesmanID IN   ( Select SalesmanID from Salesman where Salesman_Name like @SalesPerson)   and #Cus.SalesmanID=Salesman.SalesmanID AND   --Salesman.Salesman_Name = @SalesPerson And   --(Select SalesmanID from Salesman where Salesman_Name like @SalesPerson ) And   #Cus3.Balance > 1   Order By #Cus.CustomerID,#Cus.DocumentID--, #Cus.DueDate
